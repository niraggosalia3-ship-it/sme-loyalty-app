// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model SME {
  id                String      @id @default(cuid())
  companyName       String
  uniqueLinkId      String      @unique
  bannerImageUrl    String?
  programName       String?     // e.g., "Gold Rewards Program"
  programDescription String?    // Main program description
  pointsEarningRules String?    // How customers earn points
  pointsMultiplier  Float       @default(1.0) // Points per dollar spent
  primaryColor      String?     // Brand primary color (hex)
  secondaryColor    String?     // Brand secondary color (hex)
  createdAt         DateTime    @default(now())
  customers         Customer[]
  tiers             Tier[]
}

model Tier {
  id          String   @id @default(cuid())
  smeId       String
  name        String   // e.g., "Bronze", "Silver", "Gold"
  pointsRequired Int   // Points needed to reach this tier
  benefits    String   // JSON array of benefits or comma-separated
  color       String?  // Tier color (hex)
  order       Int      // Display order (0, 1, 2, ...)
  sme         SME      @relation(fields: [smeId], references: [id], onDelete: Cascade)
}

model Customer {
  id                 String           @id @default(cuid())
  smeId              String
  name               String
  birthDate          DateTime
  email              String
  gender             String
  points             Int              @default(0)
  tier               String           @default("Bronze")
  qrCodeId           String           @unique
  lastTierUpgradeDate DateTime?
  createdAt          DateTime         @default(now())
  sme                SME              @relation(fields: [smeId], references: [id], onDelete: Cascade)
  transactions       Transaction[]
  customerBenefits   CustomerBenefit[]
}

model Transaction {
  id          String   @id @default(cuid())
  customerId  String
  points      Int
  description String
  amount      Float?   // Transaction amount (before tax)
  taxAmount   Float?   // Tax amount
  createdAt   DateTime @default(now())
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

model CustomerBenefit {
  id          String   @id @default(cuid())
  customerId  String
  tierId      String
  benefitName String
  unlockedAt  DateTime @default(now())
  usedAt      DateTime?
  status      String   @default("available") // "available" | "used" | "expired"
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

